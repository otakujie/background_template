<!--suppress JSJQueryEfficiency -->
<html>

<head>
    <meta charset="utf-8">
    <title>{:lang('user_list')}</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="__STATIC__/admin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="__STATIC__/admin/style/admin.css" media="all">

    <link rel="stylesheet" href="__STATIC__/css/formSelects-v4.css" media="all">
    <style>
        .wechat_cross_btn_group {
            margin-left: 15px;
        }
        .cf:after{visibility:hidden;display:block;font-size:0;content:" ";clear:both;height:0}* html .cf{zoom:1}*:first-child+html .cf{zoom:1}html{margin:0;padding:0}h1{font-size:1.75em;margin:0 0 .6em 0}a{color:#2996cc}a:hover{text-decoration:none}p{line-height:1.5em}.small{color:#666;font-size:.875em}.large{font-size:1.25em}.dd{position:relative;display:block;margin:0;padding:0;max-width:600px;list-style:none;font-size:13px;line-height:20px}.dd-list{display:block;position:relative;margin:0;padding:0;list-style:none}.dd-list .dd-list{padding-left:30px}.dd-collapsed .dd-list{display:none}.dd-item,.dd-empty,.dd-placeholder{display:block;position:relative;margin:0;padding:0;min-height:20px;font-size:13px;line-height:20px}.dd-handle{display:block;height:30px;margin:5px 0;padding:5px 10px;color:#333;text-decoration:none;font-weight:bold;border:1px solid #ccc;background:#fafafa;background:-webkit-linear-gradient(top,#fafafa 0,#eee 100%);background:-moz-linear-gradient(top,#fafafa 0,#eee 100%);background:linear-gradient(top,#fafafa 0,#eee 100%);-webkit-border-radius:3px;border-radius:3px;box-sizing:border-box;-moz-box-sizing:border-box}.dd-handle:hover{color:#2ea8e5;background:#fff}.dd-item>button{display:block;position:relative;cursor:pointer;float:left;width:25px;height:20px;margin:5px 0;padding:0;text-indent:100%;white-space:nowrap;overflow:hidden;border:0;background:transparent;font-size:12px;line-height:1;text-align:center;font-weight:bold}.dd-item>button:before{content:'+';display:block;position:absolute;width:100%;text-align:center;text-indent:0}.dd-item>button[data-action="collapse"]:before{content:'-'}.dd-placeholder,.dd-empty{margin:5px 0;padding:0;min-height:30px;background:#f2fbff;border:1px dashed #b6bcbf;box-sizing:border-box;-moz-box-sizing:border-box}.dd-empty{border:1px dashed #bbb;min-height:100px;background-color:#e5e5e5;background-image:-webkit-linear-gradient(45deg,#fff 25%,transparent 25%,transparent 75%,#fff 75%,#fff),-webkit-linear-gradient(45deg,#fff 25%,transparent 25%,transparent 75%,#fff 75%,#fff);background-image:-moz-linear-gradient(45deg,#fff 25%,transparent 25%,transparent 75%,#fff 75%,#fff),-moz-linear-gradient(45deg,#fff 25%,transparent 25%,transparent 75%,#fff 75%,#fff);background-image:linear-gradient(45deg,#fff 25%,transparent 25%,transparent 75%,#fff 75%,#fff),linear-gradient(45deg,#fff 25%,transparent 25%,transparent 75%,#fff 75%,#fff);background-size:60px 60px;background-position:0 0,30px 30px}.dd-dragel{position:absolute;pointer-events:none;z-index:9999}.dd-dragel>.dd-item .dd-handle{margin-top:0}.dd-dragel .dd-handle{-webkit-box-shadow:2px 4px 6px 0 rgba(0,0,0,.1);box-shadow:2px 4px 6px 0 rgba(0,0,0,.1)}.nestable-lists{display:block;clear:both;padding:30px 0;width:100%;border:0;}#nestable-menu{padding:0;margin:20px 0}#nestable-output,#nestable2-output{width:100%;height:7em;font-size:.75em;line-height:1.333333em;font-family:Consolas,monospace;padding:5px;box-sizing:border-box;-moz-box-sizing:border-box}#nestable2 .dd-handle{color:#fff;border:1px solid #999;background:#bbb;background:-webkit-linear-gradient(top,#bbb 0,#999 100%);background:-moz-linear-gradient(top,#bbb 0,#999 100%);background:linear-gradient(top,#bbb 0,#999 100%)}#nestable2 .dd-handle:hover{background:#bbb}#nestable2 .dd-item>button:before{color:#fff}@media only screen and (min-width:700px){.dd{float:left;width:48%}.dd+.dd{margin-left:2%}}.dd-hover>.dd-handle{background:#2ea8e5!important}.dd3-content{display:block;height:30px;margin:5px 0;padding:5px 10px 5px 40px;color:#333;text-decoration:none;font-weight:bold;border:1px solid #ccc;background:#fafafa;background:-webkit-linear-gradient(top,#fafafa 0,#eee 100%);background:-moz-linear-gradient(top,#fafafa 0,#eee 100%);background:linear-gradient(top,#fafafa 0,#eee 100%);-webkit-border-radius:3px;border-radius:3px;box-sizing:border-box;-moz-box-sizing:border-box}.dd3-content:hover{color:#2ea8e5;background:#fff}.dd-dragel>.dd3-item>.dd3-content{margin:0}.dd3-item>button{margin-left:30px}.dd3-handle{position:absolute;margin:0;left:0;top:0;cursor:pointer;width:30px;text-indent:100%;white-space:nowrap;overflow:hidden;border:1px solid #aaa;background:#ddd;background:-webkit-linear-gradient(top,#ddd 0,#bbb 100%);background:-moz-linear-gradient(top,#ddd 0,#bbb 100%);background:linear-gradient(top,#ddd 0,#bbb 100%);border-top-right-radius:0;border-bottom-right-radius:0}.dd3-handle:before{content:'≡';display:block;position:absolute;left:0;top:3px;width:100%;text-align:center;text-indent:0;color:#fff;font-size:20px;font-weight:normal}.dd3-handle:hover{background:#ddd}

    </style>
</head>
<body>


<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">{:lang('role')}</div>
                <div class="layui-card-body">
                    <span class="layui-badge-dot"></span> 排序决定等级，越小权限越高，只能一维

                    <button class="layui-btn layui-btn-sm" id="save_order">保存排序</button>
                    <div class="cf nestable-lists">
                        <div class="dd" id="nestable">
                            <ol class="dd-list">
                                {volist id='vo' name='list'}
                                <li class="dd-item" data-role_id="{$vo.role_id}">
                                    <div class="dd-handle">{$vo.role_name} </div>
                                    <div class="dd-btn" style="position: absolute;right: 5px;top: 7px;">
                                        <a href="javascript:ediRole('{$vo.role_id}');">编辑</a>
                                    </div>
                                </li>
                                {/volist}
                            </ol>
                        </div>
                        <div  class="dd" id="add_ban">
                            <div class="layui-card" style="border: 1px solid #d6d6d6;">
                                <div class="layui-card-header">添加新角色</div>
                                <div class="layui-card-body">

                                    <div class="layui-form" action="">
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">{:lang('role')}</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="role_name" required  lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">{:lang('auth')}</label>
                                            <div class="layui-input-block" >
                                                <select name="role_auth" xm-select="select_auth" xm-select-search="">
                                                    {volist id="vo" name="auth_list"}
                                                    <option value="{$vo.auth_id}">{$vo.auth_name}</option>
                                                    {/volist}
                                                </select>
                                            </div>
                                            <div class="layui-form-mid layui-word-aux"></div>
                                        </div>
                                        <div class="layui-form-item">
                                            <div class="layui-input-block">
                                                <button class="layui-btn" lay-submit lay-filter="add_role">立即提交</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.bootcss.com/jquery/3.4.0/jquery.min.js"></script>
<script src="__STATIC__/admin/layui/layui.js"></script>
<script src="__STATIC__/js/nestable.js"></script>
<script>
    layui.config({
        base: '__STATIC__/admin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块,
        ,formSelects: 'formSelects-v4'
    }).use(['index', 'jquery','form','formSelects','siam'], function () {
        var roleOrder = '';
        var form = layui.form;
        var layer = layui.layer;
        var formSelects = layui.formSelects;
        var admin = layui.admin;
        var siam = layui.siam;

        window.ediRole = function (role_id){
            var url = "{:url('role/edi', ['role_id' => '__RID__','do_uid'=>'__DO__'])}";
            url =  url.replace("__RID__", role_id);
            url =  url.replace("__DO__", siam.get('u_id'));

            layer.open({
                type: 2,
                title: "{:lang('edi')}",
                content: url,
                area:['70%','90%']
            })
        };

        $(document).ready(function () {
            var updateOutput = function (e) {
                var list = e.length ? e : $(e.target),
                    output = list.data("output");
                if (window.JSON) {
                    roleOrder = window.JSON.stringify(list.nestable("serialize"));
                } else {
                    layer.alert('浏览器不支持json');
                }
            };
            $("#nestable").nestable({
                group: 1
            }).on("change", updateOutput);

            updateOutput($("#nestable").data("output", $("#nestable-output")));
        });

        $("#save_order").click(function () {
            admin.req({
                url : "{:url('api/role/order_update')}",
                data: {
                    order : roleOrder
                },
                type: "post",
                dataType: "json",
                success:function(res){
                    if(res.code === '200'){
                        layer.alert('成功')
                    }else{
                        layer.alert(res.msg);
                    }
                }
            })
        });

        form.on('submit(add_role)', function(data){
            admin.req({
                url : "{:url('api/role/add')}",
                data: data.field,
                type: "post",
                dataType: "json",
                success:function(res){
                    if(res.code === '200'){
                        layer.alert('成功');
                        window.location.reload();
                    }else{
                        layer.alert(res.msg);
                    }
                }
            })
        });
    });

</script>


</body>
</html>